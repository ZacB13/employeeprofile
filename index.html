<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Profile Form</title>
  <!-- Cropper.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .logo { text-align: center; margin-bottom: 15px; }
    .logo img { max-width: 150px; }
    h1 { text-align: center; color: #00477A; margin: 10px 0 20px; letter-spacing: 1px; }
    .centered { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px; }
    .centered label { font-weight: bold; }
    .centered input { width: 200px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .row { display: flex; gap: 20px; margin-bottom: 20px; }
    .photo-box { width: 180px; height: 180px; border: 2px dashed #ccc; background: #fafafa; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
    .photo-box img { max-width: 100%; max-height: 100%; display: block; }
    .photo-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
    .crop-controls { text-align: center; margin-top: 10px; }
    .crop-btn, .submit-btn { padding: 8px 16px; font-size: 14px; border: none; border-radius: 4px; cursor: pointer; }
    .crop-btn { background-color: #00477A; color: #fff; margin-right: 8px; }
    .crop-btn:disabled { background: #ccc; cursor: default; }
    .submit-btn { margin-top: 30px; width: 100%; background-color: #00477A; color: #fff; padding:12px; }
    .submit-btn:hover { background-color: #003b60; }
    .submit-btn:active { transform: scale(0.98); }
    #attach-instruction { display: none; font-style: italic; color: #555; text-align: center; margin-top: 10px; }
    .fields { flex: 1; }
    .fields label { display: block; font-weight: bold; margin-top: 10px; }
    .fields input { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    .section { margin-top: 20px; }
    .section label { font-weight: bold; display: block; margin-bottom: 6px; }
    .section textarea { width: 100%; padding: 8px; height: 80px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; box-sizing: border-box; background: #fafafa; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="logo.jpg" alt="Lake Glass & Mirror Logo">
    </div>
    <div class="centered">
      <label for="gc-name">General Contractor:</label>
      <input type="text" id="gc-name" name="gc-name" placeholder="Company name">
      <label for="job-name">Job Name:</label>
      <input type="text" id="job-name" name="job-name" placeholder="Job name">
    </div>
    <h1>EMPLOYEE PROFILE</h1>
    <form id="profile-form">
      <div class="row">
        <div>
          <div class="photo-box" id="photo-box">
            <span>Click to add &amp; crop photo</span>
            <input type="file" accept="image/*" id="photo-input" class="photo-input">
          </div>
          <div class="crop-controls">
            <button type="button" id="crop-accept-btn" class="crop-btn" disabled>Accept Crop</button>
          </div>
        </div>
        <div class="fields">
          <label for="emp-name">Name</label>
          <input type="text" id="emp-name" name="emp-name" required>
          <label for="emp-contact">Contact Info</label>
          <input type="text" id="emp-contact" name="emp-contact" required>
          <label for="years-lgm">Years with LG&amp;M</label>
          <input type="text" id="years-lgm" name="years-lgm">
          <label for="years-industry">Years in Industry</label>
          <input type="text" id="years-industry" name="years-industry">
          <label for="position">Position</label>
          <input type="text" id="position" name="position">
        </div>
      </div>
      <div class="section">
        <label for="notable-jobs">Notable Jobs</label>
        <textarea id="notable-jobs" name="notable-jobs"></textarea>
      </div>
      <div class="section">
        <label for="certificates">Certificates</label>
        <textarea id="certificates" name="certificates"></textarea>
      </div>
      <div class="section">
        <label for="qualifications">Qualifications</label>
        <textarea id="qualifications" name="qualifications"></textarea>
      </div>
      <div class="section">
        <label for="other-notes">Other Notes</label>
        <textarea id="other-notes" name="other-notes" style="height: 120px;"></textarea>
      </div>
      <button type="button" class="submit-btn" id="submit-btn">Submit</button>
      <p id="attach-instruction">PDF downloaded. Please attach it to the email before sending.</p>
    </form>
  </div>
  <!-- Cropper.js JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <!-- jsPDF UMD build -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let cropper, croppedDataURL;
      const photoInput = document.getElementById('photo-input');
      const photoBox = document.getElementById('photo-box');
      const acceptBtn = document.getElementById('crop-accept-btn');
      const instruction = document.getElementById('attach-instruction');

      photoInput.addEventListener('change', function() {
        const file = this.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          photoBox.innerHTML = '';
          const img = document.createElement('img');
          img.id = 'photo-preview';
          img.src = e.target.result;
          photoBox.appendChild(img);
          cropper = new Cropper(img, { aspectRatio: 1, viewMode: 1, autoCropArea: 1, background: false, movable: true, zoomable: true });
          acceptBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      });

      acceptBtn.addEventListener('click', function() {
        if (!cropper) return;
        const canvas = cropper.getCroppedCanvas({ width: 200, height: 200 });
        croppedDataURL = canvas.toDataURL('image/jpeg');
        photoBox.innerHTML = '';
        const img = document.createElement('img'); img.src = croppedDataURL;
        photoBox.appendChild(img);
        cropper.destroy(); cropper = null;
        acceptBtn.disabled = true;
      });

      document.getElementById('submit-btn').addEventListener('click', function() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'letter' });

        // Header
        const logoImg = new Image();
        logoImg.src = 'logo.jpg';
        logoImg.onload = () => { doc.addImage(logoImg, 'JPG', 40, 30, 60, 60); drawContent(); };
        logoImg.onerror = drawContent;

        function drawContent() {
          doc.setFontSize(12);
          doc.text(`General Contractor: ${document.getElementById('gc-name').value}`, 120, 50);
          doc.text(`Job Name: ${document.getElementById('job-name').value}`, 120, 68);
          doc.setFontSize(16);
          doc.text('EMPLOYEE PROFILE', doc.internal.pageSize.getWidth()/2, 100, { align: 'center' });

          if (croppedDataURL) {
            doc.addImage(croppedDataURL, 'JPEG', 40, 120, 80, 80);
          }

          doc.setFontSize(12);
          const fields = [
            { label: 'Name', id: 'emp-name' },
            { label: 'Contact Info', id: 'emp-contact' },
            { label: 'Years with LG&M', id: 'years-lgm' },
            { label: 'Years in Industry', id: 'years-industry' },
            { label: 'Position', id: 'position' }
          ];
          fields.forEach((f, i) => {
            const y = 120 + i*14;
            const val = document.getElementById(f.id).value || '';
            doc.text(`${f.label}: ${val}`, 140, y + 10);
          });

          let y = 220;
          ['notable-jobs','certificates','qualifications','other-notes'].forEach((id) => {
            const heading = id.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            doc.setFont(undefined, 'bold'); doc.text(heading, 40, y);
            doc.setFont(undefined, 'normal');
            const text = document.getElementById(id).value || '';
            const lines = doc.splitTextToSize(text, doc.internal.pageSize.getWidth() - 80);
            doc.text(lines, 40, y + 12);
            y += lines.length * 12 + 20;
          });

          const name = document.getElementById('emp-name').value || 'profile';
          doc.save(`Employee_Profile_${name}.pdf`);
          window.location.href = `mailto:zacb@lakeglassandmirror.com?subject=Employee Profile - ${encodeURIComponent(name)}`;
          instruction.style.display = 'block';
        }
      });
    });
  </script>
</body>
</html>


